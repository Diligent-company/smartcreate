<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CV Preview - SmartCV</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 2rem;
      background: #fff;
      color: #222;
      font-size: 16px;
      line-height: 1.5;
    }
    h1, h2 {
      color: #004080;
      margin-bottom: 0.3rem;
    }
    h2 {
      border-bottom: 2px solid #004080;
      padding-bottom: 0.3rem;
      margin-top: 2rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 15px;
    }
    table, th, td {
      border: 1px solid #bbb;
    }
    th, td {
      padding: 0.5rem;
      text-align: left;
      vertical-align: top;
    }
    ul {
      padding-left: 1.5rem;
      list-style-type: disc;
      margin-top: 0.5rem;
    }
    .section {
      margin-bottom: 2rem;
    }
    .declaration {
      font-style: italic;
      margin-top: 3rem;
      border-top: 1px solid #ccc;
      padding-top: 1rem;
    }
    button.print-btn {
      background-color: #004080;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1.2rem;
      cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
      margin-bottom: 1.5rem;
    }
    header.page-header {
      background-color: #004080;
      color: white;
      text-align: center;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    footer.page-footer {
      background: #002244;
      color: white;
      padding: 30px 20px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      font-size: 0.95em;
      margin-top: 40px;
    }
    footer.page-footer div {
      margin: 10px 0;
      min-width: 150px;
    }
    footer.page-footer h4 {
      margin-bottom: 10px;
      color: #ffffff;
      border-bottom: 1px solid #777;
      padding-bottom: 5px;
    }
    footer.page-footer a {
      display: block;
      color: #ddd;
      text-decoration: none;
      margin: 5px 0;
    }
    footer.page-footer a:hover {
      color: #fff;
    }
    @media print {
      button.print-btn,
      header.page-header,
      footer.page-footer {
        display: none !important;
      }
      body {
        font-size: 14pt;
      }
      h1, h2 {
        page-break-after: avoid;
      }
    }
  </style>
</head>
<body>
  <header class="page-header">
    <h1>SmartCV</h1>
    <p>Your professional CV preview</p>
  </header>

  <button class="print-btn" onclick="window.print()">Print or Save as PDF</button>

  <div id="cvContent"></div>

  <footer class="page-footer">
    <div>
      <h4>Navigation</h4>
      <a href="index.html">Home</a>
      <a href="about.html">About Us</a>
      <a href="contact.html">Contact</a>
    </div>
    <div>
      <h4>Support</h4>
      <a href="faqs.html">FAQs</a>
      <a href="terms.html">Terms & Conditions</a>
      <a href="privacy.html">Privacy Policy</a>
    </div>
  </footer>

  <script>
    const data = JSON.parse(localStorage.getItem('cvData')) || {};

    function createSection(title, html) {
      return `<section class="section"><h2>${title}</h2>${html}</section>`;
    }

    function createTable(headers, rows) {
      if (!rows || rows.length === 0) return '<p>No data provided.</p>';
      const thead = '<thead><tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr></thead>';
      const tbody = '<tbody>' + rows.map(row => {
        return '<tr>' + row.map(cell => `<td>${cell}</td>`).join('') + '</tr>';
      }).join('') + '</tbody>';
      return `<table>${thead}${tbody}</table>`;
    }

    function createBulletList(items) {
      if (!items || items.length === 0) return '<p>None provided.</p>';
      return '<ul>' + items.map(i => `<li>${i}</li>`).join('') + '</ul>';
    }

    // Format education rows: make sure year is one column, e.g. "2020-2023"
    const formattedEducation = (data.education || []).map(ed => {
      // ed expected: [Level, School/University, Award, Year, Grades]
      // Just keep year as is.
      return ed;
    });

    // Format experience rows similarly
    const formattedExperience = (data.experience || []).map(exp => {
      // exp expected: [Job Title, Time, Institution, Department, Position, Office Tel]
      return exp;
    });

    // Language skills: data.languageSkills = array of [Language, Speaking, Writing]
    const languageSkills = (data.languageSkills || []).map(ls => {
      // In case undefined values, replace with empty string
      return ls.map(v => v || '');
    });

    // Computer skills: data.computerSkills = array of [Software, Proficiency]
    const computerSkills = (data.computerSkills || []).map(cs => {
      return cs.map(v => v || '');
    });

    // Competencies, interests, referees are arrays of strings
    const competencies = data.competencies || [];
    const interests = data.interests || [];
    const referees = data.referees || [];

    // Personal info section HTML
    const personalInfoHtml = `
      <p><strong>Email:</strong> ${data.email || ''}</p>
      <p><strong>Phone:</strong> ${data.phone || ''}</p>
      <p><strong>Address:</strong> ${data.address || ''}</p>
      <p><strong>Nationality:</strong> ${data.nationality || ''}</p>
      <p><strong>Date of Birth:</strong> ${data.dob || ''}</p>
      <p><strong>Gender:</strong> ${data.gender || ''}</p>
      <p><strong>Marital Status:</strong> ${data.marital_status || ''}</p>
      <p><strong>NIDA / NIDA:</strong> ${data.NIDA || ''}</p>
    `;

    // Compose full CV content
    const cvHtml = `
      <h1>${data.fullname || 'Your Full Name'}</h1>

      ${createSection('Personal Summary', `<p>${data.summary || ''}</p>`)}
      ${createSection('Personal Information', personalInfoHtml)}
      ${createSection('Education Background', createTable(
        ['Level', 'School/University', 'Award', 'Year', 'Grades'],
        formattedEducation
      ))}
      ${createSection('Working Experience', createTable(
        ['Job Title', 'Time', 'Institution', 'Department', 'Position', 'Office Tel'],
        formattedExperience
      ))}
      ${createSection('Language Skills', createTable(
        ['Language', 'Speaking', 'Writing'],
        languageSkills
      ))}
      ${createSection('Computer Skills', createTable(
        ['Software', 'Proficiency'],
        computerSkills
      ))}
      ${createSection('Key Competencies', createBulletList(competencies))}
      ${createSection('Interests and Hobbies', createBulletList(interests))}
      ${createSection('Referees', createBulletList(referees))}
      <div class="declaration">
        <p>I, <strong>${data.fullname || '[Full Name]'}</strong>, declare that the information provided above is true and correct to the best of my knowledge and belief.</p>
      </div>
    `;

    document.getElementById('cvContent').innerHTML = cvHtml;
  </script>
</body>
</html>
